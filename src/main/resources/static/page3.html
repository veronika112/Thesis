<meta charset="utf-8" />
<html>
<head>
<style>
#teachers {
	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
	border-collapse: collapse;
	width: 60%;
}

#teachers td, #teachers th {
	border: 1px solid #ddd;
	padding: 8px;
}

#teachers th {
	padding-top: 12px;
	padding-bottom: 12px;
	text-align: left;
	background-color: #7DBBE8;
	color: white;
}

.button {
	background-color: #7DBBE8; /* Blue */
	border: none;
	color: white;
	padding: 15px 32px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	position: absolute;
}

.button2 {
	background-color: #7DBBE8; /* Blue */
	border: none;
	color: white;
	padding: 16px;
	font-size: 16px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
}

.responsive-table-input-matrix {
	display: block;
	position: relative;
	width: 100%; &: after { clear : both;
	content: '';
	display: block;
	font-size: 0;
	height: 0;
	visibility: hidden;
}

tbody {
	display: block;
	overflow-x: auto;
	position: relative;
	white-space: nowrap;
	width: auto; tr { display : inline-block;
	vertical-align: top; td { display : block;
	text-align: center;
	&:
	first-child
	{
	text-align
	:
	left;
}

}
}
}
thead {
	display: block;
	float: left;
	margin-right: 10px; &: after { clear : both;
	content: "";
	display: block;
	font-size: 0;
	height: 0;
	visibility: hidden;
}

th:first-of-type {
	height: 1.4em;
}

th {
	display: block;
	text-align: right;
	&:
	first-child
	{
	text-align
	:
	right;
}

}
}
}
table {
	width: 100%;
	border-collapse: collapse;
}

th {
	background: #7DBBE8;
	color: white;
	font-weight: bold;
}

td, th {
	padding: 6px;
	border: 1px solid #ccc;
	text-align: left;
}

.button {
	background-color: #7DBBE8; /* Blue */
	border: none;
	color: white;
	padding: 15px 32px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	position: absolute;
}

.button2 {
	background-color: #7DBBE8; /* Blue */
	border: none;
	color: white;
	padding: 12px 16px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
}

.dropbtn {
	background-color: #B7C1C8;
	color: black;
	padding: 16px;
	font-size: 16px;
	border: none;
	cursor: pointer;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
	position: relative;
	display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
	display: none;
	position: absolute;
	background-color: #f9f9f9;
	min-width: 160px;
	box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
	z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
	color: black;
	padding: 12px 16px;
	text-decoration: none;
	display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {
	background-color: #f1f1f1
}

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {
	display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {
	background-color: #D3E5F2;
}

/* The Modal (background) */
.modal {
	display: none; /* Hidden by default */
	position: fixed; /* Stay in place */
	z-index: 1; /* Sit on top */
	padding-top: 100px; /* Location of the box */
	left: 0;
	top: 0;
	width: 100%; /* Full width */
	height: 100%; /* Full height */
	overflow: auto; /* Enable scroll if needed */
	background-color: rgb(0, 0, 0); /* Fallback color */
	background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
	background-color: #fefefe;
	margin: auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
}
</style>
</head>
<body>
	<meta charset="utf-8" />
	<center>

		<div style="text-align: center">
			<h1>Генератор на учебна програма!</h1>
			<br>
			<h2>Списък на избраните лекционните преподаватели за {N}
				семестър:</h2>
		</div>
		<br> <br> <br>
		<table id="teachers">
			<tr>
				<th>№</th>
				<th>Преподавател</th>
				<th>Зала</th>
				<th>Заетост</th>
			</tr>
		</table>
	</center>


	<!-- The Modal -->
	<div id="myModal" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<center>
				<h3 id="textToBeChanged">AAA</h3>
				<table id="tableForTimetable" class="responsive-table-input-matrix">
					<thead>
						<tr>
							<th></th>
							<th>7:30-8:15</th>
							<th>8:30-9:15</th>
							<th>9:30-10:15</th>
							<th>10:30-11:15</th>
							<th>11:30-12:15</th>
							<th>12:30-13:15</th>
							<th>13:45-14:30</th>
							<th>14:45-15:30</th>
							<th>15:45-16:30</th>
							<th>16:45-17:30</th>
							<th>17:45-18:30</th>
							<th>18:45-19:30</th>
							<th>19:45-20:30</th>
							<th>20:45-21:30</th>
					</thead>
					<tbody>
						<tr>
							<td>Понеделник</td>
							<td><input value="01" type="checkbox"></td>
							<td><input value="02" type="checkbox"></td>
							<td><input value="03" type="checkbox"></td>
							<td><input value="04" type="checkbox"></td>
							<td><input value="05" type="checkbox"></td>
							<td><input value="06" type="checkbox"></td>
							<td><input value="07" type="checkbox"></td>
							<td><input value="08" type="checkbox"></td>
							<td><input value="09" type="checkbox"></td>
							<td><input value="010" type="checkbox"></td>
							<td><input value="011" type="checkbox"></td>
							<td><input value="012" type="checkbox"></td>
							<td><input value="013" type="checkbox"></td>
							<td><input value="014" type="checkbox"></td>
						</tr>
						<tr>
							<td>Вторник</td>
							<td><input value="11" type="checkbox"></td>
							<td><input value="12" type="checkbox"></td>
							<td><input value="13" type="checkbox"></td>
							<td><input value="14" type="checkbox"></td>
							<td><input value="15" type="checkbox"></td>
							<td><input value="16" type="checkbox"></td>
							<td><input value="17" type="checkbox"></td>
							<td><input value="18" type="checkbox"></td>
							<td><input value="19" type="checkbox"></td>
							<td><input value="10" type="checkbox"></td>
							<td><input value="111" type="checkbox"></td>
							<td><input value="112" type="checkbox"></td>
							<td><input value="113" type="checkbox"></td>
							<td><input value="114" type="checkbox"></td>
						</tr>
						<tr>
							<td>Сряда</td>
							<td><input value="21" type="checkbox"></td>
							<td><input value="22" type="checkbox"></td>
							<td><input value="23" type="checkbox"></td>
							<td><input value="24" type="checkbox"></td>
							<td><input value="25" type="checkbox"></td>
							<td><input value="26" type="checkbox"></td>
							<td><input value="27" type="checkbox"></td>
							<td><input value="28" type="checkbox"></td>
							<td><input value="29" type="checkbox"></td>
							<td><input value="210" type="checkbox"></td>
							<td><input value="211" type="checkbox"></td>
							<td><input value="212" type="checkbox"></td>
							<td><input value="213" type="checkbox"></td>
							<td><input value="214" type="checkbox"></td>
						</tr>
						<tr>
							<td>Четвъртък</td>
							<td><input value="31" type="checkbox"></td>
							<td><input value="32" type="checkbox"></td>
							<td><input value="33" type="checkbox"></td>
							<td><input value="34" type="checkbox"></td>
							<td><input value="35" type="checkbox"></td>
							<td><input value="36" type="checkbox"></td>
							<td><input value="37" type="checkbox"></td>
							<td><input value="38" type="checkbox"></td>
							<td><input value="39" type="checkbox"></td>
							<td><input value="310" type="checkbox"></td>
							<td><input value="311" type="checkbox"></td>
							<td><input value="312" type="checkbox"></td>
							<td><input value="313" type="checkbox"></td>
							<td><input value="314" type="checkbox"></td>
						</tr>
						<tr>
							<td>Петък</td>
							<td><input value="41" type="checkbox"></td>
							<td><input value="42" type="checkbox"></td>
							<td><input value="43" type="checkbox"></td>
							<td><input value="44" type="checkbox"></td>
							<td><input value="45" type="checkbox"></td>
							<td><input value="46" type="checkbox"></td>
							<td><input value="47" type="checkbox"></td>
							<td><input value="48" type="checkbox"></td>
							<td><input value="49" type="checkbox"></td>
							<td><input value="410" type="checkbox"></td>
							<td><input value="411" type="checkbox"></td>
							<td><input value="412" type="checkbox"></td>
							<td><input value="413" type="checkbox"></td>
							<td><input value="414" type="checkbox"></td>
						</tr>
					</tbody>
				</table>
			</center>
			<button class="button2" onclick="getTimetable()">Запази</button>
		</div>
	</div>
	<br>
	<br>
	<br>
	<br>
	<div>
		<button style="left: 20%;" class="button">Назад</button>
		<button style="left: 70%;" class="button" onclick="generate()">Генериране</button>
	</div>


	<script>
		// Get the modal
		var modal = document.getElementById('myModal');
		window.onload = function load() {
	
			var allChosedTeachersID = [];
	
			for (var i = 0; i < Object.values(sessionStorage).length; i++) {
				var temp = Object.values(sessionStorage)[i];
				if (temp.indexOf(';') != -1) {
					allChosedTeachersID.push(temp.substring((temp.indexOf(';') + 1), temp.length));
				}
			}
	
			var roomsForLect = null;
	
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
	
				if (this.readyState == 4 && this.status == 200) {
					var roomsForLectures = this.responseText;
					console.log("Rooms: " + roomsForLectures);
	
					roomsForLect = JSON.parse(roomsForLectures);
				}
			}
			xhttp.open("GET", "/rooms/allByType?type=true", false);
			xhttp.send();
	
	
			var xhttp = new XMLHttpRequest();
			var teachers = null;
			var teachersTable = document.getElementById('teachers');
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					teachers = this.responseText;
					var teachersName = null;
					console.log(this.responseText);
					var teach = JSON.parse(teachers);
	
					for (var j = 0; j < allChosedTeachersID.length; j++) {
						console.log("masiwa: " + allChosedTeachersID[j]);
						var currentId = allChosedTeachersID[j];
	
						for (var k = 0; k < teach.length; k++) (function(k) {
								if (teach[k].id == currentId) {
									teachersName = teach[k].name;
	
	
									var tr = document.createElement('tr');
									var tdNum = document.createElement('td');
									tdNum.innerHTML = (j + 1);
	
									var tdName = document.createElement('td');
									tdName.innerHTML = teachersName;
	
									<!-- td -->
									var tdDropDown = document.createElement('td');
	
									<!--td dropdown -->
									var dropDown = document.createElement('div');
									dropDown.className = "dropdown";
	
	
									var dropDownContent = document.createElement('div');
									dropDownContent.id = "dropDownCon"
									dropDownContent.className = "dropdown-content";
	
									var button = document.createElement('button');
									button.className = "dropbtn";
									button.innerHTML = "Избор...";
	
	
									for (p = 0; p < roomsForLect.length; p++) (function(p) {
											var content = roomsForLect[p].id;
	
											var a = document.createElement('a');
											a.innerHTML = content;
	
											a.onclick = function() {
												button.innerHTML = content;
	
											}
											dropDownContent.appendChild(a);
										})(p);
	
									dropDown.appendChild(button);
									dropDown.appendChild(dropDownContent);
	
	
									tdDropDown.appendChild(dropDown);
	
									<!-- CHECK-BOX BUTTON -->
	
									var tdForCB = document.createElement('td');
									var buttonCB = document.createElement('button');
									buttonCB.className = "button2";
									buttonCB.innerHTML = "Избор...";
									buttonCB.onclick = function() {
										
										console.log("current teacher ID: " + teach[k].id);
										sessionStorage.setItem("currentTeacher", teach[k].id);
										
										document.getElementById("textToBeChanged").innerHTML = "Моля, отбележете невъзможността за присъствие на " + tdName.innerHTML;
										modal.style.display = "block";
										buttonCB.innerHTML = "Избран";
										this.disabled=true;
									}
	
	
									tdForCB.appendChild(buttonCB);
	
									tr.appendChild(tdNum);
									tr.appendChild(tdName);
									tr.appendChild(tdDropDown);
									tr.appendChild(tdForCB);
	
									teachersTable.appendChild(tr);
								}
							})(k);
	
					}
	
				}
			}
			xhttp.open("GET", "/teachers/all", false);
			xhttp.send();
	
		}
	
		function getTimetable() {
			var checkedValue = [];
			
			console.log("Clicked get Timetable");
			var table = document.getElementById("tableForTimetable");
			var trCont = table.children[1].children;
			console.log(trCont);
			for(var i=0; i<trCont.length; i++){
				var tdCont = trCont[i].children;
				console.log(tdCont);
				for(var j=1; j<tdCont.length; j++){
					var currTd = tdCont[j].children[0];
					if(currTd.checked){
						console.log("aaasasasasas " + currTd.value);
						checkedValue.push(currTd.value);
						currTd.checked = false;
					}
				}
			}
			var currTID = sessionStorage.getItem("currentTeacher");
			console.log(currTID);
			sessionStorage.setItem("TEACHER" + currTID, checkedValue);
			 modal.style.display = "none";
			 checkedValue = [];
		}
		
		
		function generate(){
			for(var i=0; i<sessionStorage.length; i++) {
			    var key = sessionStorage.key(i);
			    var value = sessionStorage[key];
			    console.log(key + " => " + value);
			}
			
			sessionStorage.clear();
			
			var url = "/";
			
			
		}
	</script>
</body>
</html>